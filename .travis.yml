env:
  global:
  - secure: NekIxeNqAYg/ugLp577vBp4pzKDiJZ9Re9Ot4ULoqJxYvGE1iY9msceVsTC5dfVkrt69+k4X/iH/rI/SQCR3lwkysW5tJDA5Lw21YkVaxiPOt5SUia1nmw0FDWqXiO1b/zpvC0i1knqd3dzJAOW/zVCEZSzsFKxq9qYnmbXuPNE3H9BGk9oDfRIk9wCQt+2uNS8OaezDeI3WTkTyMktAtXCtv3nzVEP8WvzZtVAhZyrXbSGZh7yZIL8BCfqNVhnS6BT7g1YKPkmwtKZTTpdo9HThk9GA/77wv88aVsAnEPbp6jBqL5kprNBCnmHTndTeZkhRqARv3ia+iE/B9a/hAzzhbH13qXca2IX0HPk3xs/uJ0Rf660GR3RgmvctUak+C1Ux3R4+zPgDPlR3Zi16Y27dgMXOXq1xCpEMRbPCGzVDj0ZbJm2BnHMAHSWVKQY2KT2Xj99TqdWPQtOILy8mQTqipRqQAqxgcgYCGnmuCMcHMS/yPMT/oupMNcw/CaJA9++uqab/nQVkQPE67/kzcQbYxMFlAbZhqmPTrSy8fkWwwZu4x9QIoQuNNYiUIzpvODmnn8NqS/wOZu08HEPb25AqAUnzP6YPW6bxPKmJwxEE2VbQuYfJB54vSQkG3DCgzs2j2xGi8uPW8QqpN7yEI9e7S03P3dEk+XCRqwWiimQ=
  - secure: c4HZbaVU7dODysScv4RUjvOARsQVyLV4+qu0M6XqUpTZYCuNFn7k5MqtIL5uGArxFGb6wzSiCVHtd3+k0LJOHIPPHr9OsjP/fA3Z00FaTZz44NYDQXePCrk4vMUjtmH1vCID7yCYlMONMa4r3zIaURj+xMxJRCVu02H1qqJ6cXhlWMD58QQsRqr1iZtMg0E7tZahkgT1rryNFxEcAHQDSTrgBR6s+VM/PWpm1ruyqvpA2Tagh5ikTFyJnEbDWloPn7vkQIowaCpoSSSejliAfPiHYf3A8RYRPiWZXsn7ZlE+cNqq1nB+j63wiYKDXCQGQXCwFMMEri/Vrm85hwk2Ff+0Asj5dcrqkhTkbvf6nBdwbxa+zPQuZWtmT9y5qxN+SFpAGfWHwjfU4OyVIhlTw0PzQoN5SVPq0GdAMUt0mKe5G+5zXR1Qo5DqIMgpTC0+mg1fqR/haPL7zr9YHRKRtZIcuHkj5rLq8fHhIdBVhicbzkv8LvanHv1g2zP2mC64O/iEyP/I/BVsDvKXQIalaDHJsJ/5YkLFYlDjJoiVin3N7XS1nWmt9u2FvjJzRnB0f3Hx7njgbrQIfW5jlmlWj+h2LyzBRtM4I0tzHPln6JqKQsCtz/BGZvh6avU2qjVw89BYhn+p/q8n4KoisUrtSizzO2Mv/1HhMOsDPTi93tI=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: DIWY2OlMMlA4sPaJ1/kWQhDg2hzdrt8Le1Vv8FAw6T/QSpBRkppIrMEVsCN/DD3SpLXh91gZa5H3lzLcE6KirlhLIT6MfI+Z+I8kKiRUCRMruo+Bf7z2AsD/ImcNJule8p9Rlhwkc3OiPDLOBUhba6dd+gDMbKSkQ84yoACewAWPlD2cCkZLVIDeYeAdW4a5hdZ1ajqV9z/ga0E6tW/Tf5yqQ+Rii+SYNp4YxHHChXlo2SlWDPOQVStAwO1oVWGQ6fmujdMSy9UxVhWpu6ACngWJnBlDElvyUXMbrXVokFog+NDP9adJVLx8kQek530aDEFtbbcRXmEqpNQPU7wWf6V7LnXHBE208gEgbpT4syyvvOyrNU+WtAJGdgxCCHlKIOMIQsUk8tF3GbUyZ3MKRZr9CwBl2PoFYFAJY4C0G7EJid+cUd5Ga5/v+SI1Uh8WKk/apPBg+b4T5teguwJNKHof+2SR6q2Q+IBLeiu3jsAM2rIEQTNfB1TmltwPRjmOyQgoBdYEJC0taBZ4IoQSBhelCySt4CPGkW4+7nYaIi0kygj070ZQOAoD2BhwyhZNZAPDEdDPS/lYsIe9qhPghf4FUttm4/uTJ9MvTwiPaO28sCdRnK/HDIhqFZaCdPRrwfU953VpYAl11GSu3PzRMdmMcZtG+iXnX2l/8TWXvH4=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: l7UxSvln4ghJq0OG8fD44suuyD+cwJ38K+yWMurCPetNucI2jDMX7+YH81plNccIKpgwIswqtgIMZ+4Df4p96v7tPnqddVTJMa3obSzef1zx0wQ6ne96464wMGlhVw6KgDO4iAF9srvH9r3h3Sd6JI3UeMtnGXPADrk9Nk8S1H13oKSORIkBwvIHpFMT0c8+L/uEw04P0Kals1iHaFzX1aWG0Ddn9ymotYmQa+nxWsgV8CLBki8HZoOgMXXdQRf4M3y1zJmCitfN5J8dOqEvCJGOqIItU0ma68QTCax5FtmzPb4gKKmEDdzg7VA8VQhGDxnZbOrnwUh0Fqxon/SHoqAQmMearDfEfHLmDc7/rFKT1lRSqeurtu9jFIiBEPpRsW59MBPbCRlchoEqhNG5BYtiwN3MHyunVcyZLfcG1UebVlxJ8G75mgfDdvabSz3t46ZDarWUjAKd3wcVjgYJqgSFA7Jv6+p5HVmB/Sw86wi3J+ezh6OSGeHFjMRz7UN11owoMkY74PBX4Tg40U4s2x2H/dzEn2KW0zdltJNE8R7V2xFiZ2RdmyD5ptcwHA548hHg6ook+aNucAcYOF57g2EQvUdwvQZZYj4vSbKf/Zqb657i/HX92VDW0n9X5DmHBYbI42eceU4nERZnc4PHDWjbE7SNif5mEWBMoUIv7Vc=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
